<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cryptocurrency Volatility Index (CVI)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 20px; }
    h1 { margin-bottom: 8px; }
    .wrap { max-width: 1200px; }
    canvas { width: 100%; height: 380px; }
    .sub { color: #666; margin: 0 0 20px 2px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Cryptocurrency Volatility Index (CVI)</h1>
    <p class="sub">Top: CVI over time. Bottom: current 30-day volatility smile (IV vs strike).</p>

    <h3>CVI (ATM 30-day IV) — time series</h3>
    <canvas id="cviIndexChart"></canvas>

    <h3 style="margin-top:28px;">Volatility smile — ~30-day expiry</h3>
    <canvas id="cviSmileChart"></canvas>
  </div>

  <script>
    async function loadJSON(path) {
      const res = await fetch(path, { cache: "no-cache" });
      if (!res.ok) throw new Error(`${path} ${res.status}`);
      return res.json();
    }

    // 1) Time series
    loadJSON("cvi_timeseries.json").then(series => {
      const labels = series.map(x => new Date(x.timestamp).toLocaleString());
      const values = series.map(x => x.cvi);
      const ctx = document.getElementById("cviIndexChart").getContext("2d");
      new Chart(ctx, {
        type: "line",
        data: {
          labels,
          datasets: [{ label: "CVI (ATM 30-day IV)", data: values, borderWidth: 2, pointRadius: 0 }]
        },
        options: {
          responsive: true,
          scales: { y: { title: { display: true, text: "Implied Volatility" }}, x: { ticks: { maxRotation: 0 } } }
        }
      });
    }).catch(() => { /* first run: file may be empty */ });

    // 2) Smile
    loadJSON("cvi.json").then(data => {
      const labels = data.map(d => d.strike);
      const ivs = data.map(d => d.implied_volatility);
      const ctx = document.getElementById("cviSmileChart").getContext("2d");
      new Chart(ctx, {
        type: "line",
        data: { labels, datasets: [{ label: "Implied Volatility", data: ivs, borderWidth: 2, pointRadius: 0 }]},
        options: {
          responsive: true,
          scales: { y: { title: { display: true, text: "IV" }}, x: { title: { display: true, text: "Strike" } } }
        }
      });
    });
  </script>
</body>
</html>
